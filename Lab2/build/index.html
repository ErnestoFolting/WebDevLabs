<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<title>Sender</title>

		

		<link rel="modulepreload" href="/_app/start-64d7e7c2.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-9696d423.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-e2314ec0.js">
		<link rel="modulepreload" href="/_app/pages/index.svelte-44e26e32.js">
		<link rel="stylesheet" href="/_app/assets/start-61d1577b.css">
		<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-0192e190.css">
		<link rel="stylesheet" href="/_app/assets/pages/index.svelte-7d95003e.css">

		<script type="module">
			import { start } from "/_app/start-64d7e7c2.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-e2314ec0.js"),
						import("/_app/pages/index.svelte-44e26e32.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/",
						query: new URLSearchParams(""),
						params: {}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<header class="svelte-t2wq17"><div class="corner svelte-t2wq17"><a href="https://kit.svelte.dev" class="svelte-t2wq17"><img src="/_app/assets/svelte-logo-87df40b8.svg" alt="SvelteKit" class="svelte-t2wq17"></a></div>

	<nav class="svelte-t2wq17"><svg viewBox="0 0 2 3" aria-hidden="true" class="svelte-t2wq17"><path d="M0,0 L1,2 C1.5,3 1.5,3 2,3 L2,0 Z" class="svelte-t2wq17"></path></svg>
		<ul class="svelte-t2wq17"><li class="svelte-t2wq17 active"><a sveltekit:prefetch href="/" class="svelte-t2wq17">Home</a></li>
			<li class="svelte-t2wq17"><a sveltekit:prefetch href="/about" class="svelte-t2wq17">About</a></li>
			<li class="svelte-t2wq17"><a sveltekit:prefetch href="/todos" class="svelte-t2wq17">Todos</a></li></ul>
		<svg viewBox="0 0 2 3" aria-hidden="true" class="svelte-t2wq17"><path d="M0,0 L0,3 C0.5,3 0.5,3 1,2 L2,0 Z" class="svelte-t2wq17"></path></svg></nav>

	<div class="corner svelte-t2wq17"></div>
</header>


<section class="svelte-1bgohwt"><div id="responseGood"><h4>Your form was successfuly sent!</h4></div>
	<div id="responseBad"><h4>Unfortunately, your form was not sent 
		</h4></div>
	<div class="form"><form action="#" id="form" class="form__body"><h1 class="form__title svelte-1bgohwt">Form sender to mail
			</h1>
			<div class="form__item"><label for="formName" class="form__label">Ім&#39;я*</label>
				<input id="formName" type="text" name="name" class="form__input _req"></div>
			<div class="form__item"><label for="formEmail" class="form__label">Пошта*</label>
				<input id="formEmail" type="text" name="email" class="form__input _req _email"></div>
			<div class="form__item"><label for="formMessage" class="form__label">Повідомлення*</label>
				<textarea name="message" id="formMessage" class="form__input _req" cols="30" rows="6"></textarea></div>
			<div class="form__item"><div class="form__label">Стать*
				</div>
				<select name="sex" class="select _req"><option value="чоловік" selected>Чоловіча</option><option value="жінка">Жіноча</option></select>
				<br>
				<button type="submit" class="form__button">Відправити</button></div></form>
		<script>"use strict"
const debounce = (fn,delay)=>{
    let timeOut;
    return function(...args){
        if(timeOut){
            clearTimeout(timeOut);
        }
        timeOut = setTimeout(()=>{
            fn(...args)
        },delay);
    };
};
document.addEventListener('DOMContentLoaded', function(){
    const form = document.getElementById('form');
    const responseGood = document.getElementById('responseGood');
    const responseBad = document.getElementById('responseBad');
    form.addEventListener("submit", preSend);
    form.addEventListener("submit", debounce(formSend,1000));
    async function preSend(e){
        form.classList.add('_sending');
        e.preventDefault();
    }
    async function formSend(){
        responseBad.classList.remove('_sending');
        responseGood.classList.remove('_sending');
        const referrerValue = document.referrer;
        let formData = {
            Name :form.elements.name.value,
            Email :form.elements.email.value,
            Message : form.elements.message.value,
            Sex :form.elements.sex.value,
            referrer: referrerValue
        }
        console.log(formData);
        let error = formValidate();
        if(error === 0){

            let response = await fetch('/api/sendmail', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json;charset=utf-8'
                },
                body: JSON.stringify(formData)
              });
            console.log(response.status);
            if(response.ok){
                responseGood.classList.add('_sending'); 
                responseBad.classList.remove('_sending');
                form.reset();
                form.classList.remove('_sending');
            }else{
                responseBad.classList.add('_sending'); 
                responseGood.classList.remove('_sending');
                alert("Помилка");
                alert(response.status);
                form.reset();
                form.classList.remove('_sending');
            }
        }else{
            alert("Заповніть обов'язкові поля та перевірте email");
            form.classList.remove('_sending')
        }
    }
    function formValidate () {
        let error = 0;
        let formReq = document.querySelectorAll('._req');
        for( let i = 0; i<formReq.length; i++){
            const input = formReq[i];
            formRemoveError(input);

            if(input.classList.contains('_email')){
                if(emailTest(input)){
                    formAddError(input);
                    error++;
                }
            }else {
                if(input.value === ''){
                    formAddError(input);
                    error++;
                }
            }
        }
        return error;
    }
    function formAddError(input){
        input.parentElement.classList.add('_error');
        input.classList.add('_error');
    }
    function formRemoveError(input){
        input.parentElement.classList.remove('_error');
        input.classList.remove('_error');
    }
    function emailTest(input){
        return !/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(input.value);
    }
});</script></div>
	
</section>



			
		</div>
	</body>
</html>
